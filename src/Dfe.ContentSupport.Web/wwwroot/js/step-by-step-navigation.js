(()=>{window.GOVUK=window.GOVUK||{};window.GOVUK.Modules=window.GOVUK.Modules||{};(function(r){function l(e){this.$module=e,this.$module.actions={},this.$module.rememberShownStep=!1,this.$module.stepNavSize=!1,this.$module.sessionStoreLink="govuk-step-nav-active-link",this.$module.activeLinkClass="app-step-nav__list-item--active",this.$module.activeStepClass="app-step-nav__step--active",this.$module.activeLinkHref="#content",this.$module.uniqueId=!1}l.prototype.init=function(){this.$module.classList.add("app-step-nav--active"),this.$module.classList.remove("js-hidden"),this.$module.stepNavSize=this.$module.classList.contains("app-step-nav--large")?"Big":"Small",this.$module.rememberShownStep=!!this.$module.hasAttribute("data-remember")&&this.$module.stepNavSize==="Big",this.$module.steps=this.$module.querySelectorAll(".js-step"),this.$module.stepHeaders=this.$module.querySelectorAll(".js-toggle-panel"),this.$module.totalSteps=this.$module.querySelectorAll(".js-panel").length,this.$module.totalLinks=this.$module.querySelectorAll(".app-step-nav__link").length,this.$module.showOrHideAllButton=!1,this.$module.uniqueId=this.$module.getAttribute("data-id")||!1,this.$module.uniqueId&&(this.$module.sessionStoreLink=this.$module.sessionStoreLink+"_"+this.$module.uniqueId);var e=new this.StepNavTracker(this.$module.uniqueId,this.$module.totalSteps,this.$module.totalLinks);this.getTextForInsertedElements(),this.addButtonstoSteps(),this.addShowHideAllButton(),this.addShowHideToggle(),this.addAriaControlsAttrForShowHideAllButton(),this.ensureOnlyOneActiveLink(),this.showPreviouslyOpenedSteps(),this.bindToggleForSteps(e),this.bindToggleShowHideAllButton(e),this.bindComponentLinkClicks(e)},l.prototype.getTextForInsertedElements=function(){this.$module.actions.showText=this.$module.getAttribute("data-show-text"),this.$module.actions.hideText=this.$module.getAttribute("data-hide-text"),this.$module.actions.showAllText=this.$module.getAttribute("data-show-all-text"),this.$module.actions.hideAllText=this.$module.getAttribute("data-hide-all-text")},l.prototype.addShowHideAllButton=function(){var e=document.createElement("div"),t=this.$module.querySelectorAll(".app-step-nav__steps")[0];e.className="app-step-nav__controls govuk-!-display-none-print",e.innerHTML='<button aria-expanded="false" class="app-step-nav__button app-step-nav__button--controls js-step-controls-button"><span class="app-step-nav__chevron app-step-nav__chevron--down js-step-controls-button-icon"></span><span class="app-step-nav__button-text app-step-nav__button-text--all js-step-controls-button-text">'+this.$module.actions.showAllText+"</span></button>",this.$module.insertBefore(e,t),this.$module.showOrHideAllButton=this.$module.querySelectorAll(".js-step-controls-button")[0]},l.prototype.addShowHideToggle=function(){for(var e=0;e<this.$module.stepHeaders.length;e++){var t=this.$module.stepHeaders[e];if(!t.querySelectorAll(".js-toggle-link").length){var s=document.createElement("span"),i=document.createElement("span"),n=document.createElement("span"),o=document.createElement("span"),a=document.createElement("span");s.className="app-step-nav__toggle-link js-toggle-link govuk-!-display-none-print",i.className="app-step-nav__button-text js-toggle-link-text",n.className="app-step-nav__chevron js-toggle-link-icon",o.className="app-step-nav__toggle-link-focus",a.className="govuk-visually-hidden",s.appendChild(o),o.appendChild(n),o.appendChild(i),a.innerHTML=" this section",s.appendChild(a),t.querySelectorAll(".js-step-title-button")[0].appendChild(s)}}},l.prototype.headerIsOpen=function(e){return typeof e.parentNode.getAttribute("show")<"u"},l.prototype.addAriaControlsAttrForShowHideAllButton=function(){var e=this.$module.querySelectorAll(".js-panel")[0].getAttribute("id");this.$module.showOrHideAllButton.setAttribute("aria-controls",e)},l.prototype.setAllStepsShownState=function(e){for(var t=[],s=0;s<this.$module.steps.length;s++){var i=new this.StepView(this.$module.steps[s],this.$module);i.setIsShown(e),e&&t.push(this.$module.steps[s].getAttribute("id"))}e?this.saveToSessionStorage(this.$module.uniqueId,JSON.stringify(t)):this.removeFromSessionStorage(this.$module.uniqueId)},l.prototype.showPreviouslyOpenedSteps=function(){for(var e=this.loadFromSessionStorage(this.$module.uniqueId)||[],t=0;t<this.$module.steps.length;t++){var s=this.$module.steps[t],i=s.getAttribute("id"),n=new this.StepView(s,this.$module),o=s.hasAttribute("data-show");this.$module.rememberShownStep&&e.indexOf(i)>-1||o&&o!=="undefined"?n.setIsShown(!0):n.setIsShown(!1)}e.length>0&&(this.$module.showOrHideAllButton.setAttribute("aria-expanded",!0),this.setShowHideAllText())},l.prototype.addButtonstoSteps=function(){for(var e=0;e<this.$module.steps.length;e++){var t=this.$module.steps[e],s=t.querySelectorAll(".js-step-title")[0],i=t.querySelectorAll(".js-panel")[0].getAttribute("id"),n=s.textContent||s.innerText;s.outerHTML='<span class="js-step-title"><button class="app-step-nav__button app-step-nav__button--title js-step-title-button" aria-expanded="false" aria-controls="'+i+'"><span class="app-step-nav____title-text-focus"><span class="app-step-nav__title-text js-step-title-text">'+n+'</span><span class="govuk-visually-hidden app-step-nav__section-heading-divider">, </span></span></button></span>'}},l.prototype.bindToggleForSteps=function(e){for(var t=this,s=this.$module.querySelectorAll(".js-toggle-panel"),i=0;i<s.length;i++)s[i].addEventListener("click",function(n){var o=new t.StepView(this.parentNode,t.$module);o.toggle();var a=this.parentNode.hasAttribute("data-optional"),u=new t.StepToggleClick(n,o,e,a,t.$module.stepNavSize);u.trackClick(),t.setShowHideAllText(),t.rememberStepState(this.parentNode)})},l.prototype.rememberStepState=function(e){if(this.$module.rememberShownStep){var t=JSON.parse(this.loadFromSessionStorage(this.$module.uniqueId))||[],s=e.getAttribute("id"),i=e.classList.contains("step-is-shown");if(i)t.push(s);else{var n=t.indexOf(s);n>-1&&t.splice(n,1)}this.saveToSessionStorage(this.$module.uniqueId,JSON.stringify(t))}},l.prototype.bindComponentLinkClicks=function(e){for(var t=this.$module.querySelectorAll(".js-link"),s=this,i=0;i<t.length;i++)t[i].addEventListener("click",function(n){var o=this.getAttribute("data-position"),a=new s.ComponentLinkClick(n,e,o,s.$module.stepNavSize);a.trackClick(),this.getAttribute("rel")!=="external"&&s.saveToSessionStorage(s.$module.sessionStoreLink,o),this.getAttribute("href")===s.$module.activeLinkHref&&(s.setOnlyThisLinkActive(this),s.setActiveStepClass())})},l.prototype.saveToSessionStorage=function(e,t){window.sessionStorage.setItem(e,t)},l.prototype.loadFromSessionStorage=function(e,t){return window.sessionStorage.getItem(e)},l.prototype.removeFromSessionStorage=function(e){window.sessionStorage.removeItem(e)},l.prototype.setOnlyThisLinkActive=function(e){for(var t=this.$module.querySelectorAll("."+this.$module.activeLinkClass),s=0;s<t.length;s++)t[s].classList.remove(this.$module.activeLinkClass);e.parentNode.classList.add(this.$module.activeLinkClass)},l.prototype.ensureOnlyOneActiveLink=function(){var e=this.$module.querySelectorAll(".js-list-item."+this.$module.activeLinkClass);if(!(e.length<=1)){var t=this.loadFromSessionStorage(this.$module.sessionStoreLink),s=this.$module.querySelectorAll("."+this.$module.activeLinkClass)[0],i=s.firstChild,n=i.getAttribute("data-position"),o=t||n,a=this.$module.querySelectorAll('[data-position="'+o+'"]')[0];a?a.parentNode.classList.contains(this.$module.activeLinkClass)||(o=a):o=n,this.removeActiveStateFromAllButCurrent(e,o),this.setActiveStepClass()}},l.prototype.removeActiveStateFromAllButCurrent=function(e,t){for(var s=0;s<e.length;s++){var i=e[s];if(i.querySelectorAll(".js-link")[0].getAttribute("data-position").toString()!==t.toString()){i.classList.remove(this.$module.activeLinkClass);var n=i.querySelectorAll(".visuallyhidden");n.length&&n[0].parentNode.removeChild(n[0])}}},l.prototype.setActiveStepClass=function(){for(var e=this.$module.querySelectorAll("."+this.$module.activeStepClass),t=0;t<e.length;t++)e[t].classList.remove(this.$module.activeStepClass),e[t].removeAttribute("data-show");var s=this.$module.querySelectorAll("."+this.$module.activeLinkClass)[0];if(s){var i=s.closest(".app-step-nav__step");i.classList.add(this.$module.activeStepClass),i.setAttribute("data-show","")}},l.prototype.bindToggleShowHideAllButton=function(e){var t=this;this.$module.showOrHideAllButton.addEventListener("click",function(s){var i=this.textContent||this.innerText,n=i===t.$module.actions.showAllText;return e.trackClick("pageElementInteraction",n?"stepNavAllShown":"stepNavAllHidden",{label:(n?t.$module.actions.showAllText:t.$module.actions.hideAllText)+": "+t.$module.stepNavSize}),t.setAllStepsShownState(n),t.$module.showOrHideAllButton.setAttribute("aria-expanded",n),t.setShowHideAllText(),!1})},l.prototype.setShowHideAllText=function(){var e=this.$module.querySelectorAll(".step-is-shown").length,t=this.$module.showOrHideAllButton.querySelector(".js-step-controls-button-icon"),s=this.$module.showOrHideAllButton.querySelector(".js-step-controls-button-text"),i=e===this.$module.totalSteps;i?(s.innerHTML=this.$module.actions.hideAllText,t.classList.remove("app-step-nav__chevron--down")):(s.innerHTML=this.$module.actions.showAllText,t.classList.add("app-step-nav__chevron--down"))},l.prototype.StepView=function(e,t){this.stepElement=e,this.stepContent=this.stepElement.querySelectorAll(".js-panel")[0],this.titleButton=this.stepElement.querySelectorAll(".js-step-title-button")[0];var s=this.stepElement.querySelectorAll(".js-step-title-text")[0];this.title=s.textContent||s.innerText,this.title=this.title.replace(/^\s+|\s+$/g,""),this.showText=t.actions.showText,this.hideText=t.actions.hideText,this.upChevronSvg=t.upChevronSvg,this.downChevronSvg=t.downChevronSvg,this.show=function(){this.setIsShown(!0)},this.hide=function(){this.setIsShown(!1)},this.toggle=function(){this.setIsShown(this.isHidden())},this.setIsShown=function(i){var n=this.stepElement.querySelectorAll(".js-toggle-link")[0],o=n.querySelector(".js-toggle-link-text"),a=n.querySelector(".js-toggle-link-icon");i?(this.stepElement.classList.add("step-is-shown"),this.stepContent.classList.remove("js-hidden"),o.innerHTML=this.hideText,a.classList.remove("app-step-nav__chevron--down")):(this.stepElement.classList.remove("step-is-shown"),this.stepContent.classList.add("js-hidden"),o.innerHTML=this.showText,a.classList.add("app-step-nav__chevron--down")),this.titleButton.setAttribute("aria-expanded",i)},this.isShown=function(){return this.stepElement.classList.contains("step-is-shown")},this.isHidden=function(){return!this.isShown()},this.numberOfContentItems=function(){return this.stepContent.querySelectorAll(".js-link").length}},l.prototype.StepToggleClick=function(e,t,s,i,n){this.target=e.target,this.stepIsOptional=i,this.stepNavSize=n,this.trackClick=function(){var o={label:this.trackingLabel(),dimension28:t.numberOfContentItems().toString()};s.trackClick("pageElementInteraction",this.trackingAction(),o)},this.trackingLabel=function(){var o=this.target.closest(".js-step").querySelectorAll(".js-toggle-panel")[0];return o.getAttribute("data-position")+" - "+t.title+" - "+this.locateClickElement()+": "+this.stepNavSize+this.isOptional()},this.stepIndex=function(){return this.$module.steps.index(t.element)+1},this.trackingAction=function(){return t.isHidden()?"stepNavHidden":"stepNavShown"},this.locateClickElement=function(){return this.clickedOnIcon()?this.iconType()+" click":this.clickedOnHeading()?"Heading click":"Elsewhere click"},this.clickedOnIcon=function(){return this.target.classList.contains("js-toggle-link")},this.clickedOnHeading=function(){return this.target.classList.contains("js-step-title-text")},this.iconType=function(){return t.isHidden()?"Minus":"Plus"},this.isOptional=function(){return this.stepIsOptional?" ; optional":""}},l.prototype.ComponentLinkClick=function(e,t,s,i){this.size=i,this.target=e.target,this.trackClick=function(){var n={label:this.target.getAttribute("href")+" : "+this.size},o=this.target.closest(".app-step-nav__list").getAttribute("data-length");o&&(n.dimension28=o),t.trackClick("stepNavLinkClicked",s,n)}},l.prototype.StepNavTracker=function(e,t,s){this.totalSteps=t,this.totalLinks=s,this.uniqueId=e,this.trackClick=function(i,n,o){window.GOVUK.analytics&&window.GOVUK.analytics.trackEvent&&(o=o||{},o.dimension26=o.dimension26||this.totalSteps.toString(),o.dimension27=o.dimension27||this.totalLinks.toString(),o.dimension96=o.dimension96||this.uniqueId,window.GOVUK.analytics.trackEvent(i,n,o))}},r.AppStepNav=l})(window.GOVUK.Modules);})();
//# sourceMappingURL=step-by-step-navigation.js.map
