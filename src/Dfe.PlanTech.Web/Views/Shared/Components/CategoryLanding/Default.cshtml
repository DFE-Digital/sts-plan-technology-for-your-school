@model CategoryLandingViewComponentViewModel

@if (Model.NoSectionsErrorRedirectUrl != null)
{
	Context.Response.Redirect(Url.Content(Model.NoSectionsErrorRedirectUrl));
}

@if (Model.ProgressRetrievalErrorMessage != null)
{
	<p id="progress-error" class="govuk-error-message">
		<span class="govuk-visually-hidden">Error:</span>@Model.ProgressRetrievalErrorMessage
	</p>
}

@if (!string.IsNullOrEmpty(Model.SectionName))
{
	<div class="govuk-panel govuk-panel--confirmation">
		<h1 class="govuk-panel__title">
			Your self-assessment for @Model.SectionName.ToLower() is complete
		</h1>
		<div class="govuk-panel__body">
			Recommendations are available
		</div>
	</div>
}

@if (!Model.Print)
{
    bool singleSectionCategory = Model.CategoryLandingSections.Count == 1;
    bool anySectionsCompleted = Model.CompletedSectionCount != 0;
    bool allSectionsCompleted = Model.CompletedSectionCount == Model.Sections.Count;

    if (!singleSectionCategory && !allSectionsCompleted)
	{
		<div class="govuk-inset-text">
			@{
                <p>@ContentfulResourcesHelper.GetCategoryLandingInsetText(Model.CategoryName.ToLower(), Model.CompletedSectionCount, Model.Resources)</p>

                if (anySectionsCompleted)
                {
                    foreach (var topic in Model.CategoryLandingSections)
					{
						<partial name="Components/CategoryLanding/SectionAssessmentLink" model='new StatusLinkViewModel { CategorySlug = @Model.CategorySlug, Section = topic, Context = "Default" }' />
					}
                }
			}
		</div>
	}

	if (anySectionsCompleted)
	{
		<form method="get" class="govuk-form-group">
			<label class="govuk-label" for="sort">
				Sort recommendations by
			</label>

			<select class="govuk-select" id="sort" name="sort">
				@foreach (RecommendationSort sortType in Enum.GetValues(typeof(RecommendationSort)))
				{
					var value = sortType.GetDisplayName();
					var label = sortType.GetDisplayName();

					var isSelected = Model.SortType.HasValue
					? string.Equals(label, Model.SortType.GetDisplayName())
					: string.Equals(label, RecommendationSort.Default.GetDisplayName());

					@if (isSelected)
					{
						<option value="@value" selected>@label</option>
					}
					else
					{
						<option value="@value">@label</option>
					}
				}
			</select>

			<button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
				Apply
			</button>
		</form>
	}
}

<partial name="Components/CategoryLanding/Sections" model="@Model" />
